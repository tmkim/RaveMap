{% include 'partials/header.html' %}
	<div class="container">
		<div class="box">
			<div class="search">
				<div class="change_city">

					<!-- use backend to show filter form;
						 enable/disable location, show slider value, query api -->

					<form class="search_form"> <!-- action="backend.py" -->
						<button type="button" class="drop">Change City</button>
					</form>
					<form class="filter_form"> <!-- action="backend.py" -->
						<input type="radio" name="location" value="current" checked> Current Location<br>
						<input type="radio" name="location" value="other"> <input type="text" placeholder="Enter Zip Code" pattern="[0-9]{5}"><br>
						Distance: 0 mi.<input type="range" name="distance" min="0" max="100" step="5">100 mi.<br>
						<button type="submit" class="submit_search">Search</button>
					</form>
				</div>
				<div class="search_map">
					<button onclick="searchBounds()">Search This Area</button>
				</div>
			</div>
			<br>
			<div id="map"></div>
		</div>
		<div class="box">
			<div class = "rave_list">
				<!-- {% for info in raves %}
					<li>{{info.name}} @ {{info.venue}} - {{info.date}}</li>
				{% endfor %} -->
			</div>
		</div>
	<div>
</body>
{% include 'partials/footer.html' %}
<script>
 var geocoder;
 var map;
 function initMap() {
	 	 map = new google.maps.Map(document.getElementById('map'), {
		 zoom: 12,
		 center: {lat: {{clat}}, lng: {{clng}}}
	 });
	 geocoder = new google.maps.Geocoder();
	 setMarkers(geocoder, map);
 }

 function setMarkers(geocoder, map) {
	 var info_window = new google.maps.InfoWindow();
	 var marker;

	 {% for v in venues %}
		 marker = new google.maps.Marker({
			 map: map,
			 position: {lat: {{v.latitude}}, lng: {{v.longitude}}}
		 });

		 google.maps.event.addListener(marker, 'click', (function(marker){
			 return function(){
					 info_window.setContent("{{v.name}}" + "<br>" + "{{v.address}}")
					 info_window.open(map, marker);

					 $.ajax({
						 url: '/ajax/show_raves/',
						 data: {
							 'venue_id': {{v.id}}
						 },
						 dataType: 'json',
						 success: function(data){
							 var rave_list_html = "<p class=\"list_title\">Raves at {{v.name}}:<p><ul>";
							 var raves = data.raves;

							 $.each(raves, function(r){
								 rave_list_html += "<li>" + raves[r].name + " - " + raves[r].date
								 + "<br>Featuring: " + raves[r].dj
								 + "<br><a target=\"_blank\" href=" + raves[r].tickets + ">Buy Tickets</a>"+ "</li>";
							 })
							 rave_list_html += "</ul>"

							 $('.rave_list').html(rave_list_html);
						 }
					 });
			 	}
		 })(marker));

	 {% endfor %}

 }
	google.maps.event.addDomListener(window, 'load', initialize);
</script>
<script src={{gmap_url}} async def></script>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
